!function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Postmonger=t()}(this,function(){var e=!1,t="0.0.14",n={},i=Array.prototype.slice,r=function(){var t=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},o=function(e,t){var n;return e.indexOf?n=e.indexOf(t):function(){var t=e.length;if("undefined"==typeof t||null===t||"number"!=typeof t)return!1;for(;t>0;)if(t-=1,e[t]===n){n=t;break}return n}(),n},s=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},a=function(){this.on=function(t,i){n[t]=n[t]||[],n[t].push({fn:i,id:r()})},this.receive=function(t,i){for(var r,s=0,a=n[t]||[];r=a[s];)r.fn.apply(this,[].concat(i)),s+=1},this.off=function(e,t){var i,r=!1;return n[e]=n[e]||[],i=o(n[e],t),i>-1&&(n[e].splice(i,1),r=!0),r},this.send=function(){var t=i.call(arguments),n=t.shift();if("undefined"!=typeof this.connect&&"undefined"!=typeof this.connect.win)try{this.connect.win.postMessage({token:e,event:n,data:t},"*")}catch(r){}}},c=function(t,n){if(n=n||{},"undefined"==typeof t)throw"Connect target window required";if("undefined"!=typeof n.methods){var i,r=[];for(i in n.methods)n.methods.hasOwnProperty(i)&&r.push(i);0!==r.length&&(n.methods=r)}return this.connect={win:t,methods:n.methods||[]},window.addEventListener?window.addEventListener("message",this._dispatch.bind(this),!1):window.attachEvent("onmessage",this._dispatch.bind(this)),this},u=function(){a.call(this),this.connect=null,this._dispatch=function(t){var n;try{n=JSON.parse(t.data)}catch(i){n=t.data}if("object"==typeof n&&n.token){if(n.token!==e)return!1;"undefined"!=typeof this.connect&&"undefined"!=typeof this.connect.methods&&-1===o(this.connect.methods,n.event)||this.receive(n.event,n.data)}return!1},this._setToken=function(t){return e=t,this},this.disconnect=function(){return window.removeEventListener?window.removeEventListener("message",this._dispatch.bind(this),!1):window.detachEvent("onmessage",this._dispatch.bind(this)),this.connect=null,this},this.connect=c};return u.prototype=new a,u.version=t,{Session:u,version:t}}); 